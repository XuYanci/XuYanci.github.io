---
layout: post
title: "JenkinsæŒç»­åŒ–é›†æˆ"
date: 2017-11-24
excerpt: "JenkinsæŒç»­åŒ–é›†æˆ"
tags: [Jenkins è‡ªåŠ¨åŒ–é›†æˆ]
comments: true
---



# JenkinsæŒç»­åŒ–é›†æˆ


# å®‰è£…



*    ä¸‹è½½å®‰è£…åŒ…å®‰è£…
*    å‘½ä»¤è¡Œå®‰è£…


## ä¸‹è½½å®‰è£…åŒ…å®‰è£…


```
http://mirrors.jenkins.io/osx/latest
```


å®‰è£…å®Œæˆåï¼Œæ‰“å¼€localhost:8080ï¼Œåç»­æ­¥éª¤å’Œå‘½ä»¤è¡Œä¸€è‡´


## å‘½ä»¤è¡Œå®‰è£…


```
brew install jenkins

brew install jenkins-lts  (å¤‡æ³¨: LTS - Long Team Support é•¿æœŸæ”¯æŒç‰ˆæœ¬,ä¹Ÿå°±æ˜¯ç¨³å®šç‰ˆ)
```


æ‰§è¡Œè¿‡ç¨‹å¦‚å›¾:



![alt_text](/assets/img/Jenkins-0.png "image_tooltip")


å®‰è£…å®Œä¹‹åå¯åŠ¨


```
brew services start jenkins
```



![alt_text](/assets/img/Jenkins-1.png "image_tooltip")


æµè§ˆå™¨è¾“å…¥ localhost: 8080 åˆæ¬¡è¿›å…¥éœ€è¦ä½ åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·:




![alt_text](/assets/img/Jenkins-2.png "image_tooltip")


éœ€è¦è¾“å…¥ç®¡ç†å‘˜å¯†ç æ¥è§£é” Jenkins 



![alt_text](/assets/img/Jenkins-3.png "image_tooltip")


æˆ‘ä»¬éœ€è¦è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼Œæ‹·è´ /Users/tdw/.jenkins/secrets/initialAdminPasswordé‡Œé¢çš„å­—ç¬¦ä¸²



![alt_text](/assets/img/Jenkins-4.png "image_tooltip")


ç‚¹å‡»ä¸‹ä¸€æ­¥ éœ€è¦è‡ªå®šä¹‰JK:




![alt_text](/assets/img/Jenkins-5.png "image_tooltip")


æˆ‘ä»¬é»˜è®¤é€‰ç¬¬ä¸€ä¸ªï¼Œç„¶åå°±å¼€å§‹å®‰è£…æ’ä»¶äº†ã€‚


![alt_text](/assets/img/Jenkins-6.png "image_tooltip")


æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œéœ€è¦åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œè‡ªå®šä¹‰è¾“å…¥å³å¯ã€‚



![alt_text](/assets/img/Jenkins-7.png "image_tooltip")


ç„¶åç”¨è¯¥ç”¨æˆ·ç™»å½•å³å¯ã€‚è‹¥åˆ›å»ºå¤±è´¥çš„è¯ï¼Œåˆ™ç”¨ä¹‹å‰çš„ç®¡ç†å‘˜è´¦æˆ· admin / 462ad52d4b1347d3a70d21791dbf6573 ç™»å½•åå†æ¬¡æ–°å»ºç”¨æˆ·å³å¯ã€‚

ç™»å½•åç•Œé¢:



![alt_text](/assets/img/Jenkins-8.png "image_tooltip")


ğŸº å®‰è£…è¿‡ç¨‹ä¹Ÿå°±Complete ! 


# åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡(å›¾æ–‡ç‰ˆ)

å®‰è£…æˆåŠŸåï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ (è·‘ä¸€ä¸‹å›¢è´·ç½‘TuanDaiV4çš„å•å…ƒæµ‹è¯•)




![alt_text](/assets/img/Jenkins-9.png "image_tooltip")


è¾“å…¥ä»»åŠ¡åç§° ä»¥åŠ é€‰æ‹©ã€æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ã€‘ ï¼Œç‚¹å‡»ã€ç¡®å®šã€‘åˆ›å»ºã€‚


![alt_text](/assets/img/Jenkins-10.png "image_tooltip")


è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„é…ç½®ç•Œé¢äº†ã€‚ æˆ‘ä»¬çš„æºç æ‰˜ç®¡åœ¨GitLabä¸Šé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å»æ’ä»¶ç®¡ç†é‡Œé¢å°†æ‰€éœ€è¦çš„æ’ä»¶è£…ä¸Šã€‚



![alt_text](/assets/img/Jenkins-11.png "image_tooltip")


é€‰æ‹©ã€å¯é€‰æ’ä»¶ã€‘è¿‡æ»¤ gitlabï¼Œå°†æ‰€æœ‰gitlabæ’ä»¶è£…ä¸Šå»ã€‚


![alt_text](/assets/img/Jenkins-12.png "image_tooltip")


å®‰è£…æˆåŠŸåå¦‚å›¾æ‰€ç¤ºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å»é…ç½®ä¸€ä¸‹GitLabç›¸å…³ï¼Œç‚¹å‡»ã€ç³»ç»Ÿç®¡ç†ã€‘- ã€ç³»ç»Ÿè®¾ç½®ã€‘- ã€GitLabã€‘ 



![alt_text](/assets/img/Jenkins-13.png "image_tooltip")




![alt_text](/assets/img/Jenkins-14.png "image_tooltip")


**Connection name** è¿™ä¸ªè‡ªå·±å¡«å†™ ï¼Œ æˆ‘è¿™è¾¹å¡«å†™ **example** ã€‚

**Gitlab host URL** è¿™ä¸ªå¡«å†™ **[http://git.example.com](http://git.example.com)**

**Credentials**  ç‚¹å‡»ã€Addã€‘æ¥æ·»åŠ 


![alt_text](/assets/img/Jenkins-15.png "image_tooltip")


**Kind** æˆ‘ä»¬é€‰æ‹©** GitLab API token**

**ID **ä¸å¡«å†™

**Description** ä¸å¡«å†™

GitLab API token å¯ä»¥åœ¨GitLabè·å–åˆ° 


![alt_text](/assets/img/Jenkins-16.png "image_tooltip")


OK å¡«å†™å®Œæ¯•åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯è¡Œï¼Œç‚¹å‡»ã€Test connectionã€‘ï¼Œæ˜¾ç¤º success åˆ™è¡¨ç¤ºæˆåŠŸã€‚


# 


![alt_text](/assets/img/Jenkins-17.png "image_tooltip")


æˆ‘ä»¬ç»§ç»­å»é…ç½®åˆšæ‰æ–°å»ºä»»åŠ¡SettingUnitTesté‡Œé¢çš„ã€æºç ç®¡ç†ã€‘ï¼Œå¡«å†™å›¢è´·çš„æ‰˜ç®¡URL ä»¥åŠ åˆ†æ”¯ ï¼Œæˆ‘è¿™é‡Œæ˜¯ feature_seï¼ï¼ttingUnitTests_20170930_xulijun



![alt_text](/assets/img/Jenkins-18.png "image_tooltip")


Credientials è¿™é‡Œæˆ‘ä»¬ç‚¹å‡» ã€Addã€‘, ç„¶å Kind æˆ‘ä»¬é€‰æ‹© SSH Username with private key , username æˆ‘ä»¬éšæ„å¡«å†™ï¼ŒPrivateKey æˆ‘ä»¬é€‰æ‹© Enter directly å¡«å†™ç§æœ‰Keyã€‚


# 


![alt_text](/assets/img/Jenkins-19.png "image_tooltip")


ç§æœ‰Keyæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå»è·å–åˆ°ã€‚



![alt_text](/assets/img/Jenkins-20.png "image_tooltip")



# è¿™æ ·çš„è¯GitLabä¹Ÿå°±åŸºæœ¬é…ç½®å¯ä»¥äº†ã€‚æˆ‘ä»¬è·‘ä¸€ä¸‹ï¼



![alt_text](/assets/img/Jenkins-21.png "image_tooltip")


çœ‹ä¸€ä¸‹å·¥ä½œç©ºé—´ï¼Œæˆ‘ä»¬ä»gitlabä¸Šæ‹‰ä¸‹æ¥ä»£ç äº†ã€‚



![alt_text](/assets/img/Jenkins-22.png "image_tooltip")


æ¥ä¸‹æ¥å°±æ˜¯ç¼–è¯‘å·¥ç¨‹ä»¥åŠè·‘å•å…ƒæµ‹è¯•ã€‚ æˆ‘ä»¬ç‚¹å‡»ã€å¢åŠ æ„å»ºæ­¥éª¤ã€‘ -  ã€Execute shellã€‘ 

è¾“å…¥ä»¥ä¸‹ä»£ç æ®µ:

# éœ€åŠ ä»¥ä¸‹ä»£ç ï¼Œå¦åˆ™pod installä¼šæç¤ºasciié”™è¯¯ç­‰


```
export LANG=en_US.UTF-8
export LANGUAGE=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# åˆ‡æ¢åˆ°å·¥ç¨‹ç›®å½•ä¸‹
cd TuanDaiV4     

# å®‰è£…cocoapods
pod install     

# ç¼–è¯‘å·¥ç¨‹&è·‘å•å…ƒæµ‹è¯•
xcodebuild -workspace TuanDaiV4.xcworkspace -scheme TuanDaiV4 -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 6,OS=9.0' test
```



![alt_text](/assets/img/Jenkins-23.png "image_tooltip")


ç‚¹å‡»ã€ä¿å­˜ã€‘ï¼Œç„¶ååˆ°è¯¥ä»»åŠ¡ä¸‹ç‚¹å‡»ã€ç«‹åˆ»æ„å»ºã€‘




![alt_text](/assets/img/Jenkins-24.png "image_tooltip")


è¿™æ—¶å€™è‹¥å‡ºç°äº† pod command not found æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œpodå‘½ä»¤ æ‰¾ä¸åˆ°ã€‚

æˆ‘ä»¬éœ€è¦åœ¨ ã€ç³»ç»Ÿè®¾ç½®ã€‘ - ã€å…¨å±€è®¾ç½®ã€‘ æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨æœ¬åœ°å‘½ä»¤è¡Œæ‰“å°$PATHè·¯å¾„ï¼Œæ‹·è´åˆ°å…¨å±€è®¾ç½®é‡Œé¢ã€‚


# 

![alt_text](/assets/img/Jenkins-25.png "image_tooltip")



# 

![alt_text](/assets/img/Jenkins-26.png "image_tooltip")



#  OKï¼Œæ¥ä¸‹æ¥å°±å†æ¬¡æ„å»ºä¸€ä¸‹ã€‚æˆåŠŸçš„è¯ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°podå®‰è£…åº“ä¸­ã€‚ã€‚ã€‚


# 


![alt_text](/assets/img/Jenkins-27.png "image_tooltip")


æ¼«é•¿çš„ç­‰å¾…åï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°æµ‹è¯•ç”¨ä¾‹è·‘èµ·æ¥äº†ã€‚


![alt_text](/assets/img/Jenkins-28.png "image_tooltip")


ğŸº è¿™æ ·ä¸€ä¸ªç®€å•çš„è·‘æµ‹è¯•ç”¨ä¾‹ä»»åŠ¡ä¹Ÿå°±æ„å»ºå®Œæ¯•äº†ï¼ å¦‚æœæµ‹è¯•ç”¨ä¾‹å¤±è´¥äº†å°±ä¼šæ˜¾ç¤ºFAIL 


## å°ç»“:



![alt_text](/assets/img/Jenkins-29.png "image_tooltip")


é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æˆ‘ä»¬äº†è§£äº†ä¸€ä¸‹JK,å°±å¦‚åŒå®ƒçš„æ ‡å¿—ä¸€æ ·ï¼Œå¦‚åŒä¸€ä½ç®¡å®¶ï¼Œç®¡ç†ä»»åŠ¡ï¼Œåˆ†é…ä»»åŠ¡ï¼Œè¿è¡Œä»»åŠ¡ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¦‚æœåé¢è¦è‡ªåŠ¨åŒ–æ—¶å€™ï¼Œä¾‹å¦‚è‡ªåŠ¨åŒ–review,è‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•ï¼Œè‡ªåŠ¨åŒ–æ‰“åŒ…å•Šã€‚éƒ½å¯ä»¥é€šè¿‡JKç®¡å®¶æ¥åšï¼


# JKé›†æˆå•å…ƒæµ‹è¯•æŠ¥å‘Š


## å®‰è£…JUnit Pluginæ’ä»¶:



![alt_text](/assets/img/Jenkins-30.png "image_tooltip")



## å‘½ä»¤è¡Œç”ŸæˆJUnitæŠ¥å‘Š:

ä»¥å‰æ˜¯ç”¨xctoolå·¥å…·æ¥ç”ŸæˆjunitæŠ¥å‘Šï¼Œä½†æ˜¯xctoolå®˜æ–¹å·²ç»è´´å‡ºå‘Šç¤ºä¸ç»´æŠ¤äº†ã€‚æˆ‘ä»¬è½¬ç”¨xcprettyã€‚


![alt_text](/assets/img/Jenkins-31.png "image_tooltip")


ä½¿ç”¨xcprettyç”Ÿæˆå•å…ƒæµ‹è¯•æŠ¥å‘Š 


```
xcodebuild -workspace TuanDaiV4.xcworkspace -scheme TuanDaiV4 -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 6,OS=9.0' -enableCodeCoverage YES clean test | xcpretty -r junit
```



## æ·»åŠ æ„å»ºåæ“ä½œ:

é€‰æ‹©ã€Publish Junit test result reportã€‘



![alt_text](/assets/img/Jenkins-32.png "image_tooltip")


å¡«å†™æµ‹è¯•æŠ¥å‘Šç”Ÿæˆçš„xmlåœ°å€(ps:**è¿™ä¸ªæ˜¯xcprettyç”Ÿæˆçš„ï¼Œå…·ä½“å¯ä»¥è‡ªå·±å»çœ‹çœ‹ç›®å½•**)ï¼Œè¿™é‡Œæˆ‘ä»¬å¡«å†™ TuanDaiV4/build/reports/junit.xml




![alt_text](/assets/img/Jenkins-33.png "image_tooltip")


ç‚¹å‡»ä¿å­˜ï¼Œé‡æ–°æ„å»ºä¸€ä¸‹ä»»åŠ¡ï¼Œæ„å»ºå®Œåå¯ä»¥çœ‹åˆ°ä¸€ä¸ªæµ‹è¯•ç»“æœ



![alt_text](/assets/img/Jenkins-34.png "image_tooltip")




![alt_text](/assets/img/Jenkins-35.png "image_tooltip")


å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´ä¸°å¯Œçš„å±•ç¤ºï¼Œæˆ‘ä»¬å®‰è£…ä¸€ä¸‹ Test Results Analyzeræ’ä»¶ã€‚ ç„¶åçœ‹ä¸€ä¸‹



![alt_text](/assets/img/Jenkins-36.png "image_tooltip")


è¿™æ ·æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•æŠ¥å‘ŠåŸºæœ¬å®Œæˆ!


# JKé›†æˆè¦†ç›–ç‡æŠ¥å‘Š

è¦†ç›–ç‡æˆ‘ä»¬ä½¿ç”¨[slather](https://github.com/SlatherOrg/slather)æ¥ç”Ÿæˆ


```
slather coverage --html --scheme TuanDaiV4 --workspace TuanDaiV4.xcworkspace  TuanDaiV4.xcodeproj
```


ä¸Šé¢æˆ‘ä»¬æ˜¯ç”Ÿæˆhtmlæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡jenkinså±•ç¤º,å®‰è£…æ’ä»¶



![alt_text](/assets/img/Jenkins-37.png "image_tooltip")


å®‰è£…æˆåŠŸåï¼Œæ·»åŠ æ„å»ºåæ“ä½œ




![alt_text](/assets/img/Jenkins-38.png "image_tooltip")


å¡«å†™HTMLç›®å½•ä»¥åŠindex page


![alt_text](/assets/img/Jenkins-39.png "image_tooltip")


ä¿å­˜åé‡æ–°æ„å»ºä»»åŠ¡ï¼Œæˆ‘ä»¬çœ‹çœ‹



![alt_text](/assets/img/Jenkins-40.png "image_tooltip")



![alt_text](/assets/img/Jenkins-41.png "image_tooltip")



![alt_text](/assets/img/Jenkins-42.png "image_tooltip")


è¿™æ ·è¦†ç›–ç‡æŠ¥å‘ŠåŸºæœ¬å®Œæˆï¼


# Tips


### å‘½ä»¤è¡Œå…³é—­è¿›ç¨‹ (é€‚ç”¨äºå®‰è£…åŒ…å®‰è£…æƒ…å½¢)


```
ps -e | grep jenkins
53 ?? 0:02.51 /usr/bin/java -jar /Applications/Jenkins/jenkins.war 392 ttys000 0:00.00 grep jenkins
$ sudo kill 53
```



### å‘½ä»¤è¡Œå¼€å§‹daemon/åœæ­¢daemon (é€‚ç”¨äºå®‰è£…åŒ…å®‰è£…æƒ…å½¢)


```
Start Jenkins: sudo launchctl load /Library/LaunchDaemons/org.jenkins-ci.plist
Stop Jenkins: sudo launchctl unload /Library/LaunchDaemons/org.jenkins-ci.plist
```



### å‘½ä»¤è¡Œå¸è½½Jenkins (é€‚ç”¨äºå®‰è£…åŒ…å®‰è£…æƒ…å½¢)


```
'/Library/Application Support/Jenkins/Uninstall.command'
```


æ‰§è¡Œè¿‡ç¨‹å¦‚å›¾



![alt_text](/assets/img/Jenkins-43.png "image_tooltip")
