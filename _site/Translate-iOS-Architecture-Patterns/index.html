<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Translate-iOS-Architecture-Patterns – 一朵云风</title> <meta name="description" content="Yanci is an ios developer from shenzhen, now is working for RaodShowLive. which is an roadshow live service platform."> <meta name="keywords" content="ios architecture"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="Translate-iOS-Architecture-Patterns"> <meta name="twitter:description" content="Translate-iOS-Architecture-Patterns"> <meta name="twitter:site" content="@TWWind"> <meta name="twitter:creator" content="@TWWind"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Translate-iOS-Architecture-Patterns"> <meta property="og:description" content="Translate-iOS-Architecture-Patterns"> <meta property="og:url" content="http://localhost:4000/Translate-iOS-Architecture-Patterns/"> <meta property="og:site_name" content="一朵云风"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <link rel="canonical" href="http://localhost:4000/Translate-iOS-Architecture-Patterns/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="一朵云风 Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- 百度统计 --> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?c86955c3d2189170232d1f59c6e368d0"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <!-- google analytics --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-60787758-1', 'auto'); ga('send', 'pageview'); </script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="一朵云风 photo" class="author-photo"> <h4>一朵云风</h4> <p>Yanci is an ios developer from shenzhen, now is working for RaodShowLive. which is an roadshow live service platform.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/TWWind" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/XuYanci" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://www.weibo.com/5316510203" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-weibo"></i> Weibo</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Translate-iOS-Architecture-Patterns</h1> <h4>16 Jan 2017</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h3 id="ios-architecture-patterns">iOS Architecture Patterns</h3> <h4 id="demystifying-mvc-mvp-mvvm-and-viper">Demystifying MVC, MVP, MVVM and VIPER</h4> <p>对使用iOS中的MVC感觉到奇怪，对切换到MVVM感觉到疑惑？ 听说过VIPER,但不确定它是否名副其实？</p> <p>继续阅读，你将会找到以上问题的答案，如果你无法从容的解释这些问题。</p> <p>你将会重新构建你的iOS环境中知识架构。 我们将会简单的介绍一些通用架构，通过几个例子从理论，以及实践来比较他们。如果你需要了解更多有关他们的详情，请关注链接。</p> <p>掌握好设计模式或许很让人沉迷其中，注意： 你阅读完本文后，或许自己的疑问就迎刃而解，例如这些疑问：</p> <p><strong>网络请求应该放在哪里 ： 模型 或者 控制器？</strong></p> <p><strong>我怎样传递一个模型给新视图的视图模型呢 ？</strong></p> <p><strong>谁创建了VIPER 模式 ： 路由 还是 呈现 ？</strong> </p> <p><img src="https://cdn-images-1.medium.com/max/1600/1*79nWxPpKgL7JGjYp0HrT6A.png" alt="Mou icon"></p> <h3 id="section">为什么要关注选择一个架构</h3> <p>如果你不关注的话，某一天，调试一个非常繁重的类，里面包含很多不同的东西，你将会发现自己无法去寻找和修复任何bugs。。自然地，你也无法清晰的记住这个类作为整个实体，也就是说，你将会忽略很多很重要的细节。 如果你已经身处在这种情况下，类似这样：</p> <ul> <li>这个类是UIViewController的子类</li> <li>你的数据存储是直接放到UIViewController中</li> <li>你的UIViews几乎没做任何事情</li> <li>模型是个静态的数据结构</li> <li>你的单元测试几乎无覆盖</li> </ul> <p>这个会发生，尽管事实上你已经按照Apple的设计指导和完成Apple的MVC模式，但不要感到沮丧。 Apple的MVC设计模式有些问题，我们会晚点讨论它。</p> <p>好的架构有一些什么<strong>特点</strong>：</p> <ol> <li> <p>实体间的责任<strong>分配</strong>清晰明了，有着严格的角色划分。</p> </li> <li> <p><strong>可测试性</strong>主要来自第一个特点（别担心：对于某些架构来说，可测试性是非常简单的）</p> </li> <li> <p><strong>使用简单</strong>，维护成本低</p> </li> </ol> <h4 id="section-1">为什么需要分配</h4> <p>分配能够让我们的大脑负载均衡，当我们尝试去了解事物是如何工作的。你思考的更多，开发的更好，你的大脑将更加适应的明白当中复杂性，这样你是正确的。 但是这种能力并不是总是能够很快的线性增长以及触顶。所以最简单的方式就是实体间职责分明，这个遵守<strong>单一责任原则</strong>。</p> <h4 id="section-2">为什么需要可测试</h4> <p>这并不是一个什么问题，对那些由于添加新特性或者重构了类导致的<strong>错误问题</strong>,从而使用单元测试并从中受益的人。意味着这些测试节约了开发者在运行时找到问题，从而避免在用户的机子出现以及需要花费上周的时间才能修复。</p> <h4 id="section-3">为什么需要使用简单</h4> <p>这个并没有什么答案可说，但是值得一提的是最好的代码就是没有写过代码. 代码越少，你的bug越少。 这意味着想要写更少代码不应该认为单单是因为程序员的懒惰，你选择一个简洁的方案执行的前提不应该忽略了程序的可维护性。</p> <h3 id="mvx-essentials">MV(X) essentials</h3> <p>如今我们有很多框架设计模式：</p> <ul> <li> <p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a> </p> </li> <li> <p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter">MVP</a></p> </li> <li> <p><a href="https://en.wikipedia.org/wiki/Model_View_ViewModel">MVVM</a></p> </li> <li> <p><a href="https://www.objc.io/issues/13-architecture/viper/">VIPER</a></p> </li> </ul> <p>首先当中三个存放它们的实体到三个不同的类别 ：</p> <ul> <li> <p>Models - 存放业务数据或者处理数据相关的数据访问层。例如 ‘Person’ 或者 ‘PersonDataProvider’ 类。</p> </li> <li> <p>Views - 存放展示层（GUI），在iOS中，前缀是UI的。</p> </li> <li> <p>Controller/Presenter/ViewModel - 模型和视图之间的胶水或者媒介，一般来说，通过用户在视图上的事件触发改变模型，以及模型的更新反映到用户视图上。</p> </li> </ul> <p>职责分离有助于我们：</p> <ul> <li> <p>更好的了解它们 （就如我们知道的）</p> </li> <li> <p>重用它们 （对视图和模型更具有可操作性）</p> </li> <li> <p>单独的测试它们 </p> </li> </ul> <p>让我们开始MV(X)模式，稍晚些时候再回到VIPER。</p> <h3 id="mvc">MVC</h3> <h4 id="section-4">它以前是如何的</h4> <p>在我们讨论Apple的MVC之前，我们看看传统的<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a>。</p> <p><img src="https://cdn-images-1.medium.com/max/1200/1*E9A5fOrSr0yVmc7Kly5C6A.png" alt="Mou icon"></p> <p><strong>控制器</strong>是<strong>视图</strong>和<strong>模型</strong>的中间媒介，所以它们并不知道双方。 控制器是最少可重用的，对我们来说也是正确的，因为我们必须有个地方存放一些并不适合放到<strong>模型层</strong>负责的业务逻辑。</p> <p>理论上来说，它看起来非常直截了当，但是你感觉到什么不对劲了不？你甚至听说用户认为MVC其实是 <strong>Massive View Controller</strong> 。再者，视图控制器承载东西过多也成为了iOS开发者的一个重大话题。为什么会如此呢，苹果使用传统的MVC并只是提高它一点点。 </p> <h3 id="apples-mvc">Apple’s MVC</h3> <h4 id="reality">Reality</h4> <p><img src="https://cdn-images-1.medium.com/max/1600/1*PkWjDU0jqGJOB972cMsrnA.png" alt="Mou icon"></p> <p>Cocoa MVC鼓励用户编写 <strong>Massive</strong> View Controllers,因为他们包含在<strong>视图</strong>的生命周期，很难说他们是独立的。尽管你可以将部分业务逻辑以及数据转换放到<strong>模型</strong>，你并没有太多机会可以将部分工作放到<strong>视图</strong>，绝大部分时间，视图的职责是是发送行为给<strong>控制器</strong> 。 视图控制器作为回调和所有东西的数据源，同时也分发和取消网络请求等。</p> <p>你是不是很常遇到这样的代码：</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"> <span class="k">var</span> <span class="nv">userCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCellWithIdentifier</span><span class="p">(</span><span class="s">"identifier"</span><span class="p">)</span> <span class="k">as</span> <span class="kt">UserCell</span>
 <span class="n">userCell</span><span class="o">.</span><span class="nf">configureWithUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
 </code></pre></figure> <p>这个列表行，通过视图绑定模型，这样是违反MVC的原则的，但是这个经常发生，程序员们并不觉得有什么问题。如果你很严格的遵照MVC，通过控制器来配置列表行，而不是将模型传到视图中，这个将会增加控制器的代码量。</p> <blockquote> <p>Cocoa MVC 无疑是 Massive View Controller</p> </blockquote> <p>这个问题或许不会显露出来，直到你使用<strong>单元测试</strong>（极有可能，你的工程中已经存在）。由于你的控制器和视图粘合的很紧，它将会难以测试，因为当你写控制器的时候，你不得不非常创意的模拟视图的创建以及生命周期等，这样你的业务逻辑尽可能与视图布局分离开来。</p> <p>让我们来看一个简单的演示例子：</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"> <span class="kd">import</span> <span class="kt">UIKit</span>

 <span class="kd">struct</span> <span class="kt">Person</span> <span class="p">{</span> <span class="c1">// Model</span>
   <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
   <span class="k">let</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>
 <span class="p">}</span>

 <span class="kd">class</span> <span class="kt">GreetingViewController</span> <span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span> <span class="c1">// View + Controller</span>
    <span class="k">var</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">showGreetingButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">greetingLabel</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">showGreetingButton</span><span class="o">.</span><span class="nf">addTarget</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="s">"didTapButton:"</span><span class="p">,</span> <span class="nv">forControlEvents</span><span class="p">:</span> <span class="o">.</span><span class="kt">TouchUpInside</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">didTapButton</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">greeting</span> <span class="o">=</span> <span class="s">"Hello"</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">firstName</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">lastName</span>
        <span class="k">self</span><span class="o">.</span><span class="n">greetingLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">greeting</span>
        
    <span class="p">}</span>
    <span class="c1">// layout code goes here</span>
<span class="p">}</span>
<span class="c1">// Assembling of MVC</span>
<span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"David"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Blaine"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">view</span> <span class="o">=</span> <span class="kt">GreetingViewController</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">person</span> <span class="o">=</span> <span class="n">model</span><span class="p">;</span>
 </code></pre></figure> <blockquote> <p>MVC 组装能够在展现的视图控制器执行</p> </blockquote> <p>这个看起来是否难以调试 ？ 我们可以将<strong>Greeting</strong>放到<strong>GreetingModel</strong>来单独测试它， 但是我们无法测试任何展示逻辑 （尽管例子上的逻辑不多）。 在<strong>GreetingViewController</strong>中的<strong>UIView</strong>相关方法（viewDidLoad,didTapButton）会加载所有的视图，这对单元测试是很不友好的。</p> <p>事实上，在模拟器上加载和测试 <strong>UIViews</strong>（e.g.iPhone4S）并不能保证它能够在其他设备上（e.g.iPad)工作得很好，因此我建议移除掉你单元测试配置中的 “Host Application”以及在真机上跑测试。</p> <blockquote> <p><em>View</em>和<em>Controller</em>之间的交互事实上在单元测试中不可测试的。</p> </blockquote> <p>就如同所说的那样，Cocoa MVC看起来似乎是一个非常不友好的模式。让我们对比一下它与文章开头的几个特点：</p> <ul> <li> <p>分布 - <strong>View</strong> 和 <strong>Model</strong> 实际上是分离的，但是<strong>View</strong>和<strong>Controller</strong>却耦合太深。</p> </li> <li> <p>可测试性 - 因为耦合性太深，你只能测试你的<strong>Model</strong>。</p> </li> <li> <p>使用性 - 对比其他模式代码最少。 除此之外，开发者相对比较熟悉它，同时它也方便给那些经验不足的开发者维护。</p> </li> </ul> <p>Cocoa MVC 是你的选择，如果你不想要花费太多时间去调研你的框架，或者是你的项目比较小，不值得花费太多的维护成本。</p> <blockquote> <p>Cocoa MVC 就开发速度来说，是最好的架构模式。</p> </blockquote> <h3 id="mvp">MVP</h3> <h4 id="cocoa-mvcs-promises-delivered">Cocoa MVC’s promises delivered</h4> <p><img src="https://cdn-images-1.medium.com/max/1600/1*hKUCPEHg6TDz6gtOlnFYwQ.png" alt="Mou icon"></p> <p>它看起来是不是很像Apple的MVC ? 是的，确实是，它的名称叫做<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter">MVP</a> (Passive View variant)。等一等。。。 这是否意味着Apple的MVC模式实际上是MVP? 不，当然不，你回头想一想，<strong>View</strong>和<strong>Controller</strong>是紧紧耦合在一起的，而MVP的中间层，<strong>Presenter</strong>，并没有和视图控制器的生命周期联系，<strong>View</strong>可以很容易被模拟，所以在<strong>Presenter</strong>事实上是没有任何布局代码的，但它负责更新<strong>View</strong>的数据和状态。 </p> <p><img src="https://cdn-images-1.medium.com/max/1600/1*mQVS34naM6TD2Fj4hU-LxA.jpeg" alt="Mou icon"></p> <blockquote> <p>我想告诉你的是，<strong>UIViewController</strong>其实是<strong>View</strong></p> </blockquote> <p>就<strong>MVP</strong>而言，控制器子类实际上是<strong>Views</strong>而不是<strong>Presenters</strong>。区别在于测试性较强，会损耗开发速度，因为你必须要处理数据和事件绑定，接下来看以下例子：</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">struct</span> <span class="kt">Person</span> <span class="p">{</span> <span class="c1">// Model</span>
    <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingView</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setGreeting</span><span class="p">(</span><span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingViewPresenter</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">view</span><span class="p">:</span> <span class="kt">GreetingView</span><span class="p">,</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">showGreeting</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingPresenter</span> <span class="p">:</span> <span class="kt">GreetingViewPresenter</span> <span class="p">{</span>
    <span class="k">unowned</span> <span class="k">let</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">GreetingView</span>
    <span class="k">let</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span>
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">view</span><span class="p">:</span> <span class="kt">GreetingView</span><span class="p">,</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="k">self</span><span class="o">.</span><span class="n">person</span> <span class="o">=</span> <span class="n">person</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">showGreeting</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">greeting</span> <span class="o">=</span> <span class="s">"Hello"</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">firstName</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">lastName</span>
        <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="nf">setGreeting</span><span class="p">(</span><span class="n">greeting</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingViewController</span> <span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">GreetingView</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">presenter</span><span class="p">:</span> <span class="kt">GreetingViewPresenter</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">showGreetingButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">greetingLabel</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">showGreetingButton</span><span class="o">.</span><span class="nf">addTarget</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="s">"didTapButton:"</span><span class="p">,</span> <span class="nv">forControlEvents</span><span class="p">:</span> <span class="o">.</span><span class="kt">TouchUpInside</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">didTapButton</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presenter</span><span class="o">.</span><span class="nf">showGreeting</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">setGreeting</span><span class="p">(</span><span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">greetingLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">greeting</span>
    <span class="p">}</span>
    
    <span class="c1">// layout code goes here</span>
<span class="p">}</span>
<span class="c1">// Assembling of MVP</span>
<span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"David"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Blaine"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">view</span> <span class="o">=</span> <span class="kt">GreetingViewController</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">presenter</span> <span class="o">=</span> <span class="kt">GreetingPresenter</span><span class="p">(</span><span class="nv">view</span><span class="p">:</span> <span class="n">view</span><span class="p">,</span> <span class="nv">person</span><span class="p">:</span> <span class="n">model</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
  </code></pre></figure> <h4 id="section-5">有关组合重要信息</h4> <p>MVP是第一个展示三个独立层组合的模式问题。因为我们并不希望<strong>View</strong>与<strong>Model</strong>有什么交集，同时在展示控制器(实际上是<strong>View</strong>)来完成组合动作也是不合理的，我们必须在其他地方做处理。例如，我们可以创建一个应用程式<strong>Router</strong>服务，用来完成组装和<strong>View-to-View</strong>展示。这个问题 不只是在MVP模式，在<strong>接下来的模式</strong>也存在类似问题。</p> <p>让我们看看<strong>MVP</strong>的特征：</p> <ul> <li> <p><strong>分布</strong> - 我们大部分责任都在分类 <strong>Presenter</strong>和<strong>Model</strong>，以及一个非常轻量的<strong>View</strong>（在上面的例子中,<strong>Model</strong>也是轻量的）。</p> </li> <li> <p><strong>可测试性</strong> - 非常棒，因为是视图的轻量级别，我们可以很方便的测试大部分逻辑。</p> </li> <li> <p><strong>使用性</strong> - 在我们这个不切实际且简单的例子中，代码量是MVC的双倍，同时，MVP的目的是非常清晰的。</p> </li> </ul> <blockquote> <p>iOS中的MVP意味着可测试性好，同时代码量大。</p> </blockquote> <h3 id="mvp-1">MVP</h3> <h4 id="with-bindings-and-hooters">With Bindings and Hooters</h4> <p><img src="https://cdn-images-1.medium.com/max/1200/1*bkB6Ho_G5De47IkJpaX5XQ.png" alt="Mou icon"></p> <p>还有另外一种形式的MVP – 管理控制器MVP。 这个变体包含<strong>View</strong>和<strong>Model</strong>直接绑定，<strong>Presenter</strong>仍然处理来自<strong>View</strong>的事件以及修改<strong>View</strong>。</p> <p>当时正如我们之前所说，责任不清晰分配是不友好的，以及<strong>View</strong>和<strong>Model</strong>的紧耦合。这个与桌面式Cocoa开发环境很类似。 与传统的MVC一样，我并没有想到任何一个亮点能为这个糟糕的架构写个例子。</p> <h3 id="mvvm">MVVM</h3> <p>#### The latest and the greatest of the MV(X) kind</p> <p><a href="https://en.wikipedia.org/wiki/Model_View_ViewModel">MVVM</a>是最新的MV(X)类型，让我们看看它是否会出现MV(X)之前遇到的问题。</p> <p>理论上来说 Model-View-ViewModel 看起来非常好。 <strong>View</strong>和<strong>Model</strong>我们非常熟悉，但是<strong>Mediator</strong>，则是以<strong>View Model</strong>呈现。</p> <p><img src="https://cdn-images-1.medium.com/max/1600/1*uhPpTHYzTmHGrAZy8hiM7w.png" alt="Mou icon"></p> <p>它和MVP非常类似：</p> <ul> <li> <p>MVVM将视图控制器认为是视图</p> </li> <li> <p><strong>View</strong>和<strong>Model</strong>松耦合</p> </li> </ul> <p>除此之外，<strong>binding</strong>与管理版MVP类似。 然而，绑定并不是<strong>View</strong>和<strong>Model</strong>之间，而是在<strong>View</strong>和<strong>View Model</strong>之间。</p> <p>因此，iOS中的<strong>View Model</strong>究竟是什么呢？它是<strong>View</strong>的依赖展示以及状态。 <strong>View Model</strong> 触发<strong>Model</strong>的改变以及通过更新模型自更新，由于我们绑定了<strong>View</strong>和<strong>View Model</strong>，最先的将会对应更新。</p> <h4 id="section-6">绑定</h4> <p>我在MVP部分简单的提到过它们，让我们在深入的讨论一下。 绑定是来自于OSX开发的工具箱，但是我们在iOS工具箱并没有看到。当然，我们有KVO以及通知，但它们并没有绑定来的方便。 因此，我们并不想去重写它们，我们有两个选择：</p> <ul> <li> <p>其中一个KVO绑定的库像<a href="https://github.com/Raizlabs/RZDataBinding">RZDataBinding</a>或者是<a href="https://github.com/SwiftBond/Bond">SwiftBond</a></p> </li> <li> <p>全面的<a href="https://gist.github.com/JaviLorbada/4a7bd6129275ebefd5a6">响应式编程</a>例如 <a href="https://www.google.co.uk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0CB4QFjAAahUKEwj2l6rZv5jJAhUFUhQKHWahCKs&amp;url=https%3A%2F%2Fgithub.com%2FReactiveCocoa%2FReactiveCocoa&amp;usg=AFQjCNHM-pOkluiSuPsaVwVujCDTknVFUA&amp;sig2=54zu-ATo8vDMvtXbxZYTvQ">ReactiveCocoa</a>，<a href="https://github.com/ReactiveX/RxSwift/">RxSwift</a>或者是<a href="https://github.com/mxcl/PromiseKit">PromiseKit</a>。</p> </li> </ul> <p>事实上，在今天，当你听到”MVVM”–你将会想到ReactiveCocoa等。尽管它能够通过简单的绑定来实现MVVM，ReactiveCocoa（或者siblings）能够令你最大的使用MVVM。</p> <p>有些关于响应式框架的事实：能力越大，责任越大。当你使用<em>reactive</em>时候，会很容易搞混事情。也就是说，如果你做错了东西，你会花费非常多的时间来调试程序，让我们看看这个调用栈。</p> <p><img src="https://cdn-images-1.medium.com/max/1600/1*WGIs3XQL1MtKiyApr-m9bg.png" alt="Mou icon"></p> <p>在我们这个简单的例子中，FRF框架和KVO是过度使用的，事实上我们应该显示调用<strong>View Model</strong>来使用<em>showGreeting</em>方法更新，和使用<em>greetingDidChange</em>回调方法的一些相关属性。</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"> <span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">struct</span> <span class="kt">Person</span> <span class="p">{</span> <span class="c1">// Model</span>
    <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingViewModelProtocol</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">greetingDidChange</span><span class="p">:</span> <span class="p">((</span><span class="kt">GreetingViewModelProtocol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())?</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span> <span class="c1">// function to call when greeting did change</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">showGreeting</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingViewModel</span> <span class="p">:</span> <span class="kt">GreetingViewModelProtocol</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span>
    <span class="k">var</span> <span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">greetingDidChange</span><span class="p">?(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">greetingDidChange</span><span class="p">:</span> <span class="p">((</span><span class="kt">GreetingViewModelProtocol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())?</span>
    <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">person</span><span class="p">:</span> <span class="kt">Person</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">person</span> <span class="o">=</span> <span class="n">person</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">showGreeting</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">greeting</span> <span class="o">=</span> <span class="s">"Hello"</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">firstName</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">lastName</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingViewController</span> <span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="kt">GreetingViewModelProtocol</span><span class="o">!</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">viewModel</span><span class="o">.</span><span class="n">greetingDidChange</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">unowned</span> <span class="k">self</span><span class="p">]</span> <span class="n">viewModel</span> <span class="k">in</span>
                <span class="k">self</span><span class="o">.</span><span class="n">greetingLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">viewModel</span><span class="o">.</span><span class="n">greeting</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="nv">showGreetingButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">greetingLabel</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">showGreetingButton</span><span class="o">.</span><span class="nf">addTarget</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">viewModel</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="s">"showGreeting"</span><span class="p">,</span> <span class="nv">forControlEvents</span><span class="p">:</span> <span class="o">.</span><span class="kt">TouchUpInside</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// layout code goes here</span>
<span class="p">}</span>
<span class="c1">// Assembling of MVVM</span>
<span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"David"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Blaine"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">viewModel</span> <span class="o">=</span> <span class="kt">GreetingViewModel</span><span class="p">(</span><span class="nv">person</span><span class="p">:</span> <span class="n">model</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">view</span> <span class="o">=</span> <span class="kt">GreetingViewController</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">viewModel</span> <span class="o">=</span> <span class="n">viewModel</span>
 
    
 </code></pre></figure> <p>再次回到我们的<em>特征</em>评定：</p> <ul> <li> <p><strong>分布</strong> 在我们的小例子中并不清晰，但事实上，MVVM的<strong>View</strong>相对于MVP的<strong>View</strong>有着更多的责任。因为前者是通过设置绑定，从<strong>View Model</strong>中来更新状态，后者是将所有事件传递给<strong>Presenter</strong>，并不更新自身。</p> </li> <li> <p><strong>可测性</strong> <strong>View Model</strong>与<strong>View</strong>没有任何联系，这个允许我们很方便的测试。<strong>View</strong>或许也是可以测试，但是因为依赖UIKit，我们往往会跳过它。</p> </li> <li> <p><strong>使用性</strong> 代码量和我们之前的MVP模式例子大致相同，但是在实际应用中，你必须要从<strong>View</strong>传递所有事件给<strong>Presenter</strong>和手动更新<strong>View</strong>，MVVM显得更加精简，如果使用绑定的话。</p> </li> </ul> <blockquote> <p>MVVM是非常吸引人的，因为它含有上述模式的优点，而且它并不需要额外的代码来更新视图，这归功于视图绑定。同时，它的可测试性仍然不错。</p> </blockquote> <h3 id="viper">VIPER</h3> <h4 id="ios">将乐高的建造经验转化成iOS应用设计</h4> <p><a href="https://www.objc.io/issues/13-architecture/viper/">VIPER</a>是我们最后要讲的东西，它非常有趣，因为它不是来自任何MV(X)类型。</p> <p>现在，你必定认为职责中的的粒度是非常棒的。VIPER创建了另外一种职责分离的重述。此时此刻我们有<strong>五</strong>层。</p> <p><img src="https://cdn-images-1.medium.com/max/800/1*0pN3BNTXfwKbf08lhwutag.png" alt="Mou icon"></p> <ul> <li> <p><strong>Interactor</strong> – 包含关于数据(<strong>实体</strong>)或者网络的业务逻辑，就像创建新的实体示例和通过服务器获取它们。或许你会因为其他目的使用类似<em>Services</em>和<em>Managers</em>，这些并不属于VIPER部分的额外依赖。 </p> </li> <li> <p><strong>Presenter</strong> – 包含UI相关(但是UIKit独立)业务逻辑，触发<strong>Interactor</strong>方法。</p> </li> <li> <p><strong>Entities</strong> – 简单的数据对象，并不是数据存取层，因为这是<strong>Interactor</strong>的职责。</p> </li> <li> <p><strong>Router</strong> – 负责VIPER的<strong>modules</strong>后续处理。</p> </li> </ul> <p>基本上来说，VIPER模块可以是<strong>一屏</strong>或者是我们应用程序的整个用户<strong>故事板</strong> – 就认证来说，它可能是<strong>一屏</strong>或者是几个相关的组成。你想你的LEGO块多小呢？– 取决于你自己。</p> <p>如果我们拿它和MV(x)比较，我们能够看到某些责任分布上的区别：</p> <ul> <li>
<strong>Model</strong>（数据交互）逻辑迁移到<strong>Interactor</strong>以及<strong>Entities</strong>作为哑数据结构。</li> <li>只是<strong>Controller/Presenter/ViewModel</strong>的UI展示逻辑放到了<strong>Presenter</strong>，并不是其数据改变能力。</li> <li>
<strong>VIPER</strong> 是第一个显式使用<strong>Router</strong>来处理导航的模式。</li> </ul> <blockquote> <p>使用正确的方式来处理路由是iOS应用程序的难点，MV(x)并不能解决这问题。</p> </blockquote> <p>这个例子并不能覆盖<strong>路由</strong>或者<strong>模块之间的交互</strong>，就像这些主题并没有完全覆盖MV(X)一样。</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"> <span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">struct</span> <span class="kt">Person</span> <span class="p">{</span> <span class="c1">// Entity (usually more complex e.g. NSManagedObject)</span>
    <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">GreetingData</span> <span class="p">{</span> <span class="c1">// Transport data structure (not Entity)</span>
    <span class="k">let</span> <span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">subject</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingProvider</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">provideGreetingData</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingOutput</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">receiveGreetingData</span><span class="p">(</span><span class="nv">greetingData</span><span class="p">:</span> <span class="kt">GreetingData</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingInteractor</span> <span class="p">:</span> <span class="kt">GreetingProvider</span> <span class="p">{</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">output</span><span class="p">:</span> <span class="kt">GreetingOutput</span><span class="o">!</span>
    
    <span class="kd">func</span> <span class="nf">provideGreetingData</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">person</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"David"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Blaine"</span><span class="p">)</span> <span class="c1">// usually comes from data access layer</span>
        <span class="k">let</span> <span class="nv">subject</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">firstName</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">person</span><span class="o">.</span><span class="n">lastName</span>
        <span class="k">let</span> <span class="nv">greeting</span> <span class="o">=</span> <span class="kt">GreetingData</span><span class="p">(</span><span class="nv">greeting</span><span class="p">:</span> <span class="s">"Hello"</span><span class="p">,</span> <span class="nv">subject</span><span class="p">:</span> <span class="n">subject</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="nf">receiveGreetingData</span><span class="p">(</span><span class="n">greeting</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingViewEventHandler</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">didTapShowGreetingButton</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">GreetingView</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setGreeting</span><span class="p">(</span><span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingPresenter</span> <span class="p">:</span> <span class="kt">GreetingOutput</span><span class="p">,</span> <span class="kt">GreetingViewEventHandler</span> <span class="p">{</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">view</span><span class="p">:</span> <span class="kt">GreetingView</span><span class="o">!</span>
    <span class="k">var</span> <span class="nv">greetingProvider</span><span class="p">:</span> <span class="kt">GreetingProvider</span><span class="o">!</span>
    
    <span class="kd">func</span> <span class="nf">didTapShowGreetingButton</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">greetingProvider</span><span class="o">.</span><span class="nf">provideGreetingData</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">receiveGreetingData</span><span class="p">(</span><span class="nv">greetingData</span><span class="p">:</span> <span class="kt">GreetingData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">greeting</span> <span class="o">=</span> <span class="n">greetingData</span><span class="o">.</span><span class="n">greeting</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">greetingData</span><span class="o">.</span><span class="n">subject</span>
        <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="nf">setGreeting</span><span class="p">(</span><span class="n">greeting</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GreetingViewController</span> <span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">GreetingView</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">eventHandler</span><span class="p">:</span> <span class="kt">GreetingViewEventHandler</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">showGreetingButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">greetingLabel</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">showGreetingButton</span><span class="o">.</span><span class="nf">addTarget</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="s">"didTapButton:"</span><span class="p">,</span> <span class="nv">forControlEvents</span><span class="p">:</span> <span class="o">.</span><span class="kt">TouchUpInside</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">didTapButton</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">eventHandler</span><span class="o">.</span><span class="nf">didTapShowGreetingButton</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">setGreeting</span><span class="p">(</span><span class="nv">greeting</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">greetingLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">greeting</span>
    <span class="p">}</span>
    
    <span class="c1">// layout code goes here</span>
<span class="p">}</span>
<span class="c1">// Assembling of VIPER module, without Router</span>
<span class="k">let</span> <span class="nv">view</span> <span class="o">=</span> <span class="kt">GreetingViewController</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">presenter</span> <span class="o">=</span> <span class="kt">GreetingPresenter</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">interactor</span> <span class="o">=</span> <span class="kt">GreetingInteractor</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">eventHandler</span> <span class="o">=</span> <span class="n">presenter</span>
<span class="n">presenter</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
<span class="n">presenter</span><span class="o">.</span><span class="n">greetingProvider</span> <span class="o">=</span> <span class="n">interactor</span>
<span class="n">interactor</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">presenter</span>
 </code></pre></figure> <p>同样的，我们看看它的特点：</p> <ul> <li> <p>分布 – 毫无疑问，VIPER是职责分类中最好的。</p> </li> <li> <p>可测试性 – 毫无疑问，职责分布越好，可测试越好。</p> </li> <li> <p>使用性 – 最后，就如同你猜的，前两者将会占用你大量时间来维护。你不得不为职责不大的类写大量界面。</p> </li> </ul> <h4 id="section-7">因此，乐高呢 ?</h4> <p>当使用VIPER，你就如同使用乐高块建造一个庞大帝国一样，同时这也会导致你遇到<a href="https://inessential.com/2014/03/16/smaller_please">问题</a> 。或许，使用VIPER为时过早，你应该简单的看待事情。某些人忽略了这些东西而继续大材小用。我设想他们认为他们的应用能够在将来获得许多有益的东西，即使现在维护成本有点不可思议的高。如果你也是这么认为的话，我建议你去尝试一下<a href="https://github.com/rambler-ios/Generamba">Generamba</a> – 一个能够建立VIPER框架的工具。尽管我认为，它有点像对麻雀使用<strong>自动瞄准系统</strong>而不是弹弓。</p> <h3 id="section-8">总结</h3> <p>我们对几个框架模式进行了梳理，我希望你能够从中解决你所遇到的疑惑，毫无疑问你认识到，没有任何模式是万能的，在特定的场合，通过掂量和权衡来选择架构模式。</p> <p>因此，在同一个app中可能有几种架构的混合搭配。 例如，你可能一开始使用MVC，但是你遇到一个难以使用MVC来有效的解决场景，你可能会迁移到MVVM，但只是因为某个场景使用，完全没必要重构其他场景，因为在其他场景中，MVC能够工作的很好，因为这些架构都能很容易兼容。</p> <blockquote> <p>Make everything as simple as possible, but not simpler — Albert Einstein</p> </blockquote> <h3 id="end">END</h3> <table> <thead> <tr> <th>日期</th> <th>作者</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>2017-01-21</td> <td>YC</td> <td>初步翻译完成</td> </tr> </tbody> </table> <p><strong>本文翻译自</strong> <a href="https://medium.com/ios-os-x-development/ios-architecture-%20patterns-ecba4c38de52#.67bu0gn15">iOSArchitecturePatterns</a></p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#ios%20architecture" title="Pages tagged ios architecture" class="tag"><span class="term">ios architecture</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/Translate-iOS-Architecture-Patterns/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/Translate-iOS-Architecture-Patterns/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/Translate-iOS-Architecture-Patterns/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'yanciomgblog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
